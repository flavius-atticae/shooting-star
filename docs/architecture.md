# Architecture Document

> Auto-generated by Document Project workflow on 2026-02-13.
> Mode: initial_scan | Scan Level: exhaustive

## Executive Summary

**shooting-star** is a server-side rendered (SSR) website for a yoga instructor and doula based in Québec, Canada. It presents perinatal wellness services to pregnant women and new mothers, with a strong focus on accessibility, performance, and regulatory compliance.

The application follows a **monolithic architecture** using React Router v7 with SSR, deployed to Fly.io in the Toronto region. The design emphasizes pregnancy-safe UX patterns, WCAG 2.1 AA compliance, and GDPR/PIPEDA/Law 25 conformity.

## Technology Stack

| Layer                 | Technology            | Version | Purpose                                               |
| --------------------- | --------------------- | ------- | ----------------------------------------------------- |
| **Language**          | TypeScript            | 5.8     | Strict mode, type safety                              |
| **UI Framework**      | React                 | 19      | Component-based UI                                    |
| **Routing/SSR**       | React Router          | 7       | Server-side rendering, file-based routes              |
| **Bundler**           | Vite                  | 6       | Build tool, HMR                                       |
| **Styling**           | Tailwind CSS          | 4       | Utility-first CSS                                     |
| **Component Library** | shadcn/ui             | —       | Radix-based primitives (new-york style)               |
| **Content**           | MDX                   | —       | Rich content sections                                 |
| **Email**             | Resend + React Email  | —       | Transactional emails (contact form)                   |
| **Forms**             | React Hook Form + Zod | —       | Validation, type-safe schemas                         |
| **Carousel**          | embla-carousel-react  | —       | Testimonial/image carousels                           |
| **Motion**            | framer-motion         | —       | Animations (with reduced-motion support)              |
| **Testing (Unit)**    | Vitest                | —       | Browser-mode testing with Storybook                   |
| **Testing (E2E)**     | Playwright            | —       | Cross-browser, mobile, a11y                           |
| **Testing (Visual)**  | Chromatic             | —       | Visual regression via Storybook                       |
| **Component Docs**    | Storybook             | 10      | Component development and documentation               |
| **Deployment**        | Fly.io                | —       | Edge compute, Toronto (yyz) region                    |
| **Container**         | Docker                | —       | Node 20 Alpine, multi-stage build                     |
| **CI/CD**             | GitHub Actions        | —       | 4 workflows (deploy, PR checks, Chromatic, Storybook) |
| **Code Quality**      | Codacy                | —       | Automated analysis                                    |

## Architecture Pattern

```
┌─────────────────────────────────────────────────────────┐
│                     CLIENT (Browser)                     │
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │              React Component Tree                 │   │
│  │                                                    │   │
│  │  root.tsx (Shell + MetaFunction + HoneypotProvider)│   │
│  │    ├── Header (responsive nav, scroll behavior)    │   │
│  │    ├── <Outlet /> (page routes)                    │   │
│  │    │   ├── /           → home.tsx                  │   │
│  │    │   ├── /yoga       → yoga.tsx                  │   │
│  │    │   ├── /accompagnement → doula.tsx             │   │
│  │    │   ├── /feminin-sacre → feminin-sacre.tsx      │   │
│  │    │   ├── /a-propos   → about.tsx                 │   │
│  │    │   ├── /contact    → contact.tsx (Form+Action) │   │
│  │    │   └── /health     → health.tsx (JSON)         │   │
│  │    └── Footer (contact info, navigation)           │   │
│  └──────────────────────────────────────────────────┘   │
└──────────────┬──────────────────────────────────────────┘
               │ HTTP (SSR + Form submissions)
┌──────────────▼──────────────────────────────────────────┐
│                     SERVER (Node.js)                     │
│                                                          │
│  React Router v7 Server                                  │
│  ├── Root Loader: honeypot seed injection                │
│  ├── Contact Action: validation → honeypot → rate limit  │
│  │   → Resend API (confirmation + notification emails)   │
│  ├── Health Loader: { status, timestamp, env }           │
│  └── Static asset serving (/assets/*)                    │
└─────────────────────────────────────────────────────────┘
```

### Key Patterns

| Pattern                     | Implementation                                     |
| --------------------------- | -------------------------------------------------- |
| **SSR with Hydration**      | React Router v7 server rendering, client hydration |
| **Progressive Enhancement** | Forms work without JS; actions handle server-side  |
| **Colocation**              | Components, stories, and data grouped by feature   |
| **Barrel Exports**          | `index.ts` files for clean imports                 |
| **Server-only Modules**     | `.server.ts` suffix prevents client bundling       |
| **Type Safety**             | Zod schemas + TypeScript strict mode               |

## Data Architecture

### Runtime Data Flow

```
User submits Contact Form
    │
    ▼
React Hook Form (client validation via Zod)
    │
    ▼
React Router Action (server)
    ├── 1. Parse FormData
    ├── 2. Zod schema validation (name, email, phone, service, message)
    ├── 3. Honeypot check (remix-utils, encrypted seed)
    ├── 4. Rate limiting (in-memory, IP-based, 5 req/15 min)
    ├── 5. Send confirmation email (Resend → user)
    ├── 6. Send notification email (Resend → business owner)
    └── 7. Return success/error response
```

### Static Content Data

Content is stored as typed TypeScript modules in `app/data/`:

| File                | Content                               | TypeScript Types                                |
| ------------------- | ------------------------------------- | ----------------------------------------------- |
| `home.ts`           | Hero, testimonials, services overview | `HeroContent`, `Testimonial`, `ServiceOverview` |
| `about.ts`          | Bio, philosophy, certifications       | `AboutContent`                                  |
| `doula.ts`          | Doula services, packages, FAQ         | `DoulaContent`                                  |
| `feminin-sacre.ts`  | Sacred feminine ceremonies, rituals   | `FemininSacreContent`                           |
| `call-to-action.ts` | CTA sections, button text, links      | `CTAContent`                                    |

### Validation Schema

```typescript
// Zod schema (app/lib/contact-form-schema.ts)
contactFormSchema = z.object({
  name: z.string().min(2).max(100),
  email: z.string().email(),
  phone: z.string().optional(), // Québec format (514) XXX-XXXX
  service: z.enum([...serviceOptions]),
  message: z.string().min(10).max(2000),
});
```

## Component Architecture

### Design System Foundation

Built on **shadcn/ui** (new-york variant) with Radix UI primitives:

| UI Primitive         | Base                  | Purpose                                     |
| -------------------- | --------------------- | ------------------------------------------- |
| `Button`             | Radix Slot            | CTAs, form submission (44px+ touch targets) |
| `Card`               | Native                | Service cards, testimonial cards            |
| `Carousel`           | embla-carousel        | Testimonials, image galleries               |
| `Form`               | react-hook-form + Zod | Contact form with validation                |
| `Input` / `Textarea` | Native                | Form fields with labels                     |
| `Label`              | Radix Label           | Accessible form labels                      |
| `Select`             | Radix Select          | Service type dropdown                       |
| `Separator`          | Radix Separator       | Visual dividers                             |
| `Sonner`             | sonner                | Toast notifications                         |
| `Sheet`              | Radix Dialog          | Mobile navigation drawer                    |

### Layout Components (23 modules)

Organized by page/feature:

- **Shared**: `Header`, `Footer`, `Section`, `PageLayout`
- **Home**: `Hero`, `HeroContent`, `HeroAnimations`, `Services`, `Testimonials`, `CTASection`
- **About**: `AboutContent`, `Philosophy`, `Certifications`
- **Doula**: `DoulaServices`, `DoulaPackages`, `DoulaFAQ`
- **Contact**: `ContactForm`, `ContactInfo`, `ContactMap`
- **Féminin Sacré**: `FemininSacreContent`, `Rituals`, `Ceremonies`

### Pregnancy-Safe UX Patterns

| Pattern                 | Implementation                                                    |
| ----------------------- | ----------------------------------------------------------------- |
| **Touch Targets**       | Minimum 44×44px for all interactive elements                      |
| **Reduced Motion**      | `prefers-reduced-motion` respected, `useMotionPreferences()` hook |
| **Color Safety**        | High contrast ratios, avoid nausea-triggering combinations        |
| **Keyboard Navigation** | Full keyboard support, visible focus indicators                   |
| **Calm Animations**     | Gentle transitions, no rapid flashing or jarring movements        |

## Source Tree Overview

```
shooting-star/
├── app/                          # Application source
│   ├── root.tsx                  # Shell, providers, meta
│   ├── routes.ts                 # Route definitions
│   ├── app.css                   # Global styles (Tailwind entry)
│   ├── components/
│   │   ├── layout/               # 23 layout component modules
│   │   └── ui/                   # 10 shadcn/ui primitives
│   ├── data/                     # 5 static content modules
│   ├── emails/                   # 2 React Email templates
│   ├── hooks/                    # Custom hooks (browser support, motion)
│   ├── lib/                      # Utilities, schemas, server modules
│   ├── routes/                   # 7 page routes + stories
│   └── test/                     # Test infrastructure
├── docs/                         # Project documentation
├── design/                       # Logos (SVG + PNG), mockups
├── public/fonts/                 # Self-hosted fonts
├── stories/                      # Global Storybook docs (MDX)
├── .github/workflows/            # 4 CI/CD pipelines
├── .storybook/                   # Storybook 10 configuration
└── _bmad/                        # BMAD framework files
```

See [source-tree-analysis.md](./source-tree-analysis.md) for the fully annotated tree.

## Development Workflow

### Local Development

```bash
npm install          # Install dependencies
npm run dev          # Start SSR dev server (port 5173)
npm run storybook    # Start Storybook (port 6006)
npm run test:watch   # Unit tests in watch mode
```

### Quality Gates

| Gate              | Tool                  | Trigger             |
| ----------------- | --------------------- | ------------------- |
| Type checking     | TypeScript (strict)   | `npm run typecheck` |
| Unit tests        | Vitest (browser mode) | PR checks workflow  |
| E2E tests         | Playwright (Chromium) | PR checks workflow  |
| Visual regression | Chromatic             | PR + push to main   |
| Code quality      | Codacy                | Continuous          |

See [development-guide.md](./development-guide.md) for full setup instructions.

## Deployment Architecture

### Pipeline

```
Push to main → Staging (auto) → Release tag → Production
                                                  ↕
                                            Rollback (manual)
```

### Infrastructure

| Resource          | Configuration                                 |
| ----------------- | --------------------------------------------- |
| **Platform**      | Fly.io                                        |
| **Region**        | Toronto (yyz)                                 |
| **Container**     | Node 20 Alpine, non-root user                 |
| **VM**            | Shared CPU, 1 vCPU, 512 MB RAM                |
| **Scaling**       | Auto-stop/start, 0 min machines               |
| **HTTPS**         | Forced                                        |
| **Static Assets** | Served from `/app/build/client` at `/assets/` |
| **Health Check**  | GET `/health` every 30s                       |

See [deployment-guide.md](./deployment-guide.md) for full deployment procedures.

## Testing Strategy

### Test Distribution

| Type          | Framework             | Count      | Focus                                      |
| ------------- | --------------------- | ---------- | ------------------------------------------ |
| Unit          | Vitest                | ~15 files  | Components, hooks, utilities, server logic |
| Integration   | Vitest                | 4 files    | Route rendering, navigation                |
| E2E           | Playwright            | 5 specs    | User journeys, cross-browser, mobile       |
| Visual        | Chromatic             | 18 stories | Visual regression, interaction             |
| Accessibility | jest-axe + Playwright | Embedded   | WCAG 2.1 AA compliance                     |

### Pregnancy Personas (E2E)

| Persona   | Scenario         | Test Focus                                            |
| --------- | ---------------- | ----------------------------------------------------- |
| Marie     | 3rd trimester    | Touch targets, readability, calm interactions         |
| Sophie    | Morning sickness | Color safety, motion reduction, quick task completion |
| Alexandra | Postpartum       | One-handed navigation, large targets, clear hierarchy |

### Storybook as Test Platform

Vitest runs Storybook play functions as component tests via `@storybook/experimental-addon-test`. This provides:

- Component isolation testing
- Interaction testing (user events)
- Accessibility testing (within stories)
- Visual baseline generation (Chromatic)

## Compliance

### WCAG 2.1 AA

- Semantic HTML, proper heading hierarchy
- ARIA attributes where needed
- Keyboard-navigable, visible focus
- Contrast ratios verified
- 44px+ touch targets on mobile
- `prefers-reduced-motion` support

### GDPR / PIPEDA / Québec Law 25

- Minimal data collection (contact form only)
- Clear purpose disclosure
- No tracking scripts or analytics without consent
- Server-side rate limiting and honeypot spam protection
- No persistent user data storage (email-only flow)

## Cross-References

| Document                                             | Purpose                          |
| ---------------------------------------------------- | -------------------------------- |
| [project-overview.md](./project-overview.md)         | Executive summary and tech stack |
| [api-contracts.md](./api-contracts.md)               | Server endpoints and data flow   |
| [data-models.md](./data-models.md)                   | Zod schemas and content types    |
| [component-inventory.md](./component-inventory.md)   | Full component catalog           |
| [source-tree-analysis.md](./source-tree-analysis.md) | Annotated directory tree         |
| [development-guide.md](./development-guide.md)       | Setup and dev workflow           |
| [deployment-guide.md](./deployment-guide.md)         | Fly.io deployment and CI/CD      |
