# Configuration Files

This guide explains the key configuration files in the Shooting Star project and their purposes.

## Overview

The project uses several configuration files to manage different aspects of the build process, development environment, and application behavior.

## Core Configuration Files

### `react-router.config.ts`

The main React Router configuration file that defines how the application is built and rendered.

```typescript
import type { Config } from "@react-router/dev/config";

export default {
  ssr: true,  // Server-side render by default
} satisfies Config;
```

**Purpose**: 
- Enables server-side rendering (SSR) for better SEO and performance

**When to modify**: 
- Enabling/disabling SSR (set `ssr: false` for SPA mode)
- Adding future React Router features

### `vite.config.ts`

Vite build tool configuration for development and production builds.

```typescript
import { reactRouter } from "@react-router/dev/vite";
import tailwindcss from "@tailwindcss/vite";
import { defineConfig } from "vite";
import tsconfigPaths from "vite-tsconfig-paths";

// Detect Storybook context (React Router plugin is incompatible)
const isStorybook = process.argv[1]?.includes('storybook');

export default defineConfig({
  plugins: [
    tailwindcss(),
    !isStorybook && reactRouter(),
    tsconfigPaths()
  ].filter(Boolean),
});
```

**Purpose**:
- Integrates TailwindCSS with Vite build process
- Enables TypeScript path aliases (`~/` â†’ `./app/`)
- Conditionally loads React Router plugin (disabled for Storybook)

**When to modify**:
- Adding new Vite plugins
- Changing path aliases

### `tsconfig.json`

TypeScript compiler configuration with strict mode enabled.

```json
{
  "compilerOptions": {
    "strict": true,              // Enable all strict type checks
    "target": "ES2022",          // Modern JavaScript target
    "lib": ["ES2022", "DOM"],    // Available APIs
    "paths": {
      "~/*": ["./app/*"]         // Path alias configuration
    }
  }
}
```

**Purpose**:
- Enables strict TypeScript checking for better code quality
- Sets up path aliases for clean imports
- Configures target JavaScript version and available APIs

**When to modify**:
- Changing TypeScript strict settings
- Adding new path aliases
- Updating target JavaScript version

### `package.json`

Node.js project configuration and dependency management.

**Key Scripts**:
```json
{
  "scripts": {
    "dev": "react-router dev",           # Development server
    "build": "react-router build",       # Production build
    "start": "react-router-serve build/server/index.js",  # Production server
    "typecheck": "react-router typegen && tsc"            # Type checking
  }
}
```

**Key Dependencies**:
- **@react-router/dev** - Development tools and build system
- **@react-router/node** - Node.js runtime support
- **@react-router/serve** - Production server
- **tailwindcss** - CSS framework
- **typescript** - Type system

**When to modify**:
- Adding new dependencies
- Changing build scripts
- Updating Node.js version requirements

## Generated Configuration Files

### `.react-router/types/`

**Auto-generated TypeScript types** based on your route structure.

**Purpose**:
- Provides type safety for route parameters
- Auto-completes route names in IDE
- Updates automatically when routes change

**Important**: 
- Never edit these files manually
- Generated by `npm run typecheck`
- Should be included in version control

### `tailwind.config.js`

TailwindCSS configuration with custom design system tokens.

**Contains**:
- Content paths for class scanning
- Custom breakpoints (`xs`, `sm`, `md`, `lg`, `xl`, `2xl`)
- Custom spacing values
- Custom border radius for organic feel

**Note**: Font families are defined in `app/app.css` using the `@theme` directive.

## Environment Configuration

### `.env` Files (Optional)

You can create environment-specific configuration files:

- `.env` - Default environment variables
- `.env.local` - Local development overrides (git-ignored)
- `.env.production` - Production-specific variables

**Example variables**:
```bash
# API endpoints
VITE_API_URL=https://api.example.com

# Feature flags
VITE_ENABLE_ANALYTICS=true

# Build configuration
VITE_BUILD_VERSION=1.0.0
```

**Note**: Variables must be prefixed with `VITE_` to be available in the browser.

### `fly.toml` (Deployment)

Fly.io deployment configuration for production hosting.

**Key sections**:
```toml
app = "shooting-star"
primary_region = "yyz"  # Toronto for Canadian deployment

[env]
  NODE_ENV = "production"
  PORT = "3000"

[http_service]
  internal_port = 3000
  force_https = true
```

**Purpose**: Configures container deployment settings for Fly.io with health checks and auto-scaling.

## Docker Configuration

### `Dockerfile`

Multi-stage Docker build configuration for containerized deployment.

**Image**: `node:20-alpine`

**Stages**:
1. **development-dependencies-env** - Full dependencies for build
2. **production-dependencies-env** - Production-only dependencies
3. **build-env** - Application build
4. **Final** - Optimized runtime with non-root user

**Security**: Runs as non-root user (`reactuser`) for production safety.

### `.dockerignore`

Specifies files and directories to exclude from Docker builds.

**Common exclusions**:
- `node_modules/`
- `.git/`
- `build/`
- Development files

## Dev Container Configuration

### `.devcontainer/devcontainer.json`

Dev Container configuration for VS Code and GitHub Codespaces.

**Key sections**:
```jsonc
{
  "name": "Shooting Star",
  "image": "mcr.microsoft.com/devcontainers/javascript-node:22",
  "forwardPorts": [5173, 6006],
  "postCreateCommand": "npm install && npx playwright install --with-deps chromium",
  "customizations": {
    "vscode": {
      "extensions": [...],
      "settings": {...}
    }
  }
}
```

**Purpose**:
- Provides consistent development environment across all developers
- Pre-installs VS Code extensions (Tailwind, ESLint, Prettier, Copilot, etc.)
- Configures editor settings (format on save, theme, etc.)
- Automatically installs dependencies and Playwright

**When to modify**:
- Adding new VS Code extensions for the team
- Changing default editor settings
- Updating Node.js version
- Adding post-create setup commands

## Visual Testing Configuration

### `chromatic.config.json`

Chromatic visual testing configuration for Storybook integration.

```json
{
  "onlyChanged": true,
  "projectId": "Project:692cc4b20d41658c2157a3ed",
  "zip": true
}
```

**Purpose**:
- Configures Chromatic for visual regression testing of Storybook components
- Enables automated screenshot comparisons on pull requests

**Key options**:
- **onlyChanged**: Only captures snapshots for changed stories (faster builds, lower cost)
- **projectId**: Unique identifier linking to the Chromatic project dashboard
- **zip**: Compresses Storybook build before upload (faster uploads)

**When to modify**:
- Changing snapshot capture behavior (e.g., `onlyChanged: false` for full baseline)
- Updating project ID when migrating to a new Chromatic project
- Adding options like `exitZeroOnChanges` for CI pipelines

**Related**:
- Storybook configuration: `.storybook/main.ts`
- Visual tests run automatically via `@chromatic-com/storybook` addon
- Dashboard: [chromatic.com](https://www.chromatic.com/)

## AI & Code Quality Configuration

### `.github/instructions/`

GitHub Copilot instruction files that define AI behavior in this repository.

**Files**:
- `copilot.instructions.md` - General project guidelines, tech stack, coding standards
- `codacy.instructions.md` - Codacy integration rules for automated analysis

**Purpose**:
- Ensures consistent AI-assisted development
- Documents project conventions for Copilot
- Automates code quality checks

### `.codacy/codacy.yaml`

Codacy code analysis configuration.

```yaml
runtimes:
    - java@17.0.10      # Required by PMD
    - node@22.2.0
    - python@3.11.11    # Required by Semgrep/Lizard
tools:
    - eslint@8.57.0
    - lizard@1.17.31
    - pmd@6.55.0
    - semgrep@1.78.0
    - trivy@0.66.0
```

**Purpose**:
- Configures which analysis tools run on the codebase
- ESLint for JavaScript/TypeScript linting
- Lizard for complexity analysis
- PMD for additional static analysis
- Semgrep for security analysis
- Trivy for dependency vulnerability scanning

**Note**: Codacy may automatically add runtimes and tools required for analysis.

## Configuration Best Practices

### Development vs Production

**Development**:
- Hot module replacement enabled
- Source maps for debugging
- Verbose error messages
- Development-only dependencies

**Production**:
- Minified assets
- Optimized bundles
- Error boundaries for graceful failures
- Production-only optimizations

### Type Safety

**Always use TypeScript strict mode**:
- Catches potential runtime errors at compile time
- Improves code maintainability
- Better IDE support and autocomplete

### Path Aliases

**Use the `~/` alias for app imports**:
```typescript
// Good
import { Welcome } from "~/welcome/welcome";

// Avoid
import { Welcome } from "../welcome/welcome";
```

### Environment Variables

**Best practices**:
- Use `VITE_` prefix for client-side variables
- Never commit sensitive data to `.env` files
- Use `.env.local` for local development secrets
- Document required environment variables

## Troubleshooting Configuration Issues

### TypeScript Errors
```bash
# Regenerate types
npm run typecheck

# Clear TypeScript cache
rm -rf .react-router/types
npm run typecheck
```

### Build Issues
```bash
# Clear build cache
rm -rf build/
npm run build

# Clear node modules
rm -rf node_modules/
npm install
```

### Path Alias Issues
1. Check `tsconfig.json` paths configuration
2. Ensure `vite.config.ts` includes `tsconfigPaths()` plugin
3. Restart development server after changes

---

**Next Steps**: 
- Review the [Setup Guide](./setup.md) for development environment setup
- Explore the [Tech Stack](../02-architecture/tech-stack.md) documentation
- Check [Troubleshooting](../04-reference/troubleshooting.md) for common configuration issues