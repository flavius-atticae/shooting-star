import { Meta } from '@storybook/blocks';

<Meta title="Guidelines Pregnancy-Safe/Developer Guide" />

# Guide de D√©veloppement Pregnancy-Safe

Ce guide explique comment cr√©er et tester des composants adapt√©s aux utilisatrices enceintes et nouvelles m√®res du march√© qu√©b√©cois.

## üéØ Objectifs

- **Accessibilit√©**: Composants conformes WCAG 2.1 AA avec adaptations grossesse
- **Performance**: Chargement rapide pour appareils mobiles et fatigue
- **Localisation**: Support fran√ßais qu√©b√©cois complet
- **S√©curit√©**: Protection des donn√©es de sant√© (PIPEDA, Loi 25)

## üë• Nos Personas

### Marie Dubois - Premi√®re grossesse
- **Profil**: 20 semaines, premi√®re grossesse, fatigue, naus√©es matinales
- **Appareil**: iPhone (mobile-first)
- **Besoins**: Mouvement r√©duit, temps d'interaction √©tendus, fran√ßais
- **Usage**: D√©couverte, lecture attentive, prudence

```tsx
import { withPregnancyPersona, PREGNANCY_PERSONAS } from '../decorators/pregnancy-safe';

export const MarieStory = {
  decorators: [
    withPregnancyPersona(PREGNANCY_PERSONAS.MARIE),
    withReducedMotion,
    withTouchFriendly,
  ],
  parameters: {
    viewport: { defaultViewport: 'mobile2' },
  },
};
```

### Sophie Tremblay - M√®re exp√©riment√©e
- **Profil**: Postpartum, 2 enfants, besoin d'efficacit√©
- **Appareil**: iPad (tablette √† la maison)
- **Besoins**: Contraste √©lev√©, navigation rapide, actions directes
- **Usage**: Efficacit√©, multit√¢che, gestion de planning

```tsx
export const SophieStory = {
  decorators: [
    withPregnancyPersona(PREGNANCY_PERSONAS.SOPHIE),
    withHighContrast,
    withTouchFriendly,
  ],
  parameters: {
    viewport: { defaultViewport: 'tablet' },
  },
};
```

### Alexandra Johnson - Grossesse √† risque
- **Profil**: 28 semaines, grossesse √† risque, besoins d'accessibilit√© √©lev√©s
- **Appareil**: Desktop (suivi m√©dical)
- **Besoins**: Tous les crit√®res d'accessibilit√©, temps √©tendu
- **Usage**: Prudence maximum, coordination avec √©quipe m√©dicale

```tsx
export const AlexandraStory = {
  decorators: [
    withPregnancyPersona(PREGNANCY_PERSONAS.ALEXANDRA),
    withHighContrast,
    withReducedMotion,
    withLargeText,
    withTouchFriendly,
  ],
  parameters: {
    viewport: { defaultViewport: 'desktop' },
  },
};
```

## üé® Guidelines de Design

### Couleurs Pregnancy-Safe

```scss
// ‚úÖ Couleurs approuv√©es (palette Pauline Roussel)
$primary: #618462;    // Vert calme - actions principales
$secondary: #517982;  // Bleu apaisant - support
$accent: #af6868;     // Rose chaleureux - highlights
$neutral: #5e4530;    // Brun - texte principal

// ‚ùå Couleurs √† √©viter
$medical-red: #FF0000;  // Rouge m√©dical - anxi√©t√©
$bright-orange: #FF6600; // Orange vif - peut d√©clencher naus√©es
$high-contrast-yellow: #FFFF00; // Jaune vif - fatigue visuelle
```

### Tailles de Touch Targets

```scss
// Tailles minimales pour utilisatrices enceintes
.touch-target {
  min-width: 44px;   // WCAG 2.1 AA minimum
  min-height: 44px;
  padding: 12px 16px;
  
  // Grossesse √† risque - targets plus larges
  &.high-risk {
    min-width: 56px;
    min-height: 56px; 
    padding: 16px 20px;
  }
}
```

### Animation Pregnancy-Safe

```scss
// Respecter les pr√©f√©rences de mouvement r√©duit
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

// Animations autoris√©es (douces et courtes)
.pregnancy-safe-animation {
  animation-duration: 0.3s max;
  animation-timing-function: ease-out;
  // Jamais d'animation infinie
}
```

## üß™ Testing avec Storybook

### Structure de Story Pregnancy-Safe

```tsx
import type { Meta, StoryObj } from '@storybook/react';
import { within, expect } from '@storybook/test';
import { 
  withPregnancyPersona,
  PREGNANCY_PERSONAS 
} from '../decorators/pregnancy-safe';
import { 
  runPregnancySafeTests,
  pregnancySafeInteractions 
} from '../utils/pregnancy-testing';

const meta: Meta<typeof YourComponent> = {
  title: 'Components/YourComponent/Pregnancy Personas',
  component: YourComponent,
  parameters: {
    docs: {
      description: {
        component: `
Composant test√© pour les utilisatrices enceintes du Qu√©bec.
V√©rifie l'accessibilit√©, performance et adaptation culturelle.
        `,
      },
    },
  },
};

export const MarieFirstPregnancy: StoryObj = {
  args: { /* ... */ },
  decorators: [
    withPregnancyPersona(PREGNANCY_PERSONAS.MARIE),
    withReducedMotion,
    withQuebecFrench,
  ],
  play: async ({ canvasElement }) => {
    const canvas = within(canvasElement);
    
    // Test contenu fran√ßais
    expect(canvas.getByText(/fran√ßais/i)).toBeInTheDocument();
    
    // Test tailles tactiles
    const buttons = canvas.getAllByRole('button');
    for (const button of buttons) {
      const rect = button.getBoundingClientRect();
      expect(rect.height).toBeGreaterThanOrEqual(44);
    }
    
    // Interaction pregnancy-safe
    await pregnancySafeInteractions.clickSafely(buttons[0], 800);
  },
};
```

### Tests Automatiques

```bash
# Tests Storybook avec personas
npm run test:pregnancy-safe

# Tests accessibilit√© complets
npm run test:storybook

# Tests E2E + Storybook + Unit
npm run test:all
```

## üìù Checklist de Validation

### ‚úÖ Accessibilit√© Pregnancy-Safe
- [ ] Touch targets ‚â• 44px (‚â• 56px pour grossesse √† risque)
- [ ] Contraste couleur ‚â• 4.5:1 (‚â• 7:1 pour fatigue visuelle)
- [ ] Support clavier complet
- [ ] Animation respecte `prefers-reduced-motion`
- [ ] Pas de rouge m√©dical (#FF0000)
- [ ] Texte lisible avec fatigue

### ‚úÖ Localisation Qu√©b√©coise
- [ ] Contenu fran√ßais disponible
- [ ] Formats Quebec (postal, t√©l√©phone)
- [ ] Dates DD/MM/YYYY
- [ ] Devises CAD
- [ ] Syst√®me de sant√© RAMQ

### ‚úÖ Performance Pregnancy
- [ ] Chargement < 2.5s (LCP pregnancy-adjusted)
- [ ] Bundle JS < 200KB initial
- [ ] Images optimis√©es < 500KB
- [ ] Fonctionne hors ligne (rendez-vous m√©dicaux)

### ‚úÖ Tests avec Personas
- [ ] Story Marie (mobile, premi√®re grossesse)
- [ ] Story Sophie (tablette, efficacit√©)
- [ ] Story Alexandra (desktop, accessibilit√© max)
- [ ] Tests d'interaction pregnancy-safe
- [ ] Validation contenu fran√ßais

## üöÄ Commandes Utiles

```bash
# D√©veloppement
npm run storybook                    # Interface Storybook
npm run test:pregnancy-safe          # Tests personas
npm run test:e2e:ui                 # Tests E2E Playwright

# Validation compl√®te
npm run test:all                    # Tous les tests
npm run test:storybook:ci          # Tests CI Storybook
```

## üìö Resources

- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [Quebec Law 25](https://www.cai.gouv.qc.ca/loi-25/)
- [PIPEDA Guidelines](https://www.priv.gc.ca/en/privacy-topics/privacy-laws-in-canada/the-personal-information-protection-and-electronic-documents-act-pipeda/)
- [Storybook Testing](https://storybook.js.org/docs/react/writing-tests/introduction)

---

**Important**: Chaque composant doit √™tre test√© avec les trois personas pour garantir 
une exp√©rience optimale pour toutes les utilisatrices du march√© p√©rinatal qu√©b√©cois.